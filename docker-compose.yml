# In MERN-Chat-Calling-Application/docker-compose.yaml

services:
  mongo:
    image: mongo:6
    restart: unless-stopped
    volumes:
      - mongo_data:/data/db

  server:
    build: ./server
    environment:
      - PORT=5000
      - MONGO_URI=mongodb://mongo:27017/mern_chat
      - JWT_SECRET=aDefaultSecretKeyForYourOrchestratorPleaseChange
      # CORS_ORIGIN is no longer needed, as Nginx makes it all one origin
    # NO PORTS EXPOSED - Nginx handles all traffic
    depends_on:
      - mongo

  client:
    build:
      context: ./client
      # NO ARGS NEEDED - The frontend will use relative paths
    # NO PORTS EXPOSED
    depends_on:
      - server

  nginx:
    image: nginx:stable-alpine
    # Mount the config file you will create in the next step
    volumes:
      - ./nginx.conf:/etc/nginx/conf.d/default.conf
    ports:
      # This is the ONLY port your app exposes to the world.
      # Your orchestrator's 'openUrl' should point here.
      - "8080:80"
    depends_on:
      - client
      - server

volumes:
  mongo_data:
